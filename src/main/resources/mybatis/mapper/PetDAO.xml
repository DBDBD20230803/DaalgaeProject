<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.daalgae.daalgaeproject.pet.model.dao.PetDAO">

    <resultMap id="petResultMap" type="com.daalgae.daalgaeproject.pet.model.dto.PetDTO">
        <id property="petCode" column="PET_CODE"/>
        <result property="petNick" column="PET_NICK"/>
        <result property="petKind" column="PET_KIND"/>
        <result property="petBirth" column="PET_BIRTH"/>
        <result property="petGender" column="PET_GENDER"/>
        <result property="petWeight" column="PET_WEIGHT"/>
        <result property="petNeutered" column="PET_NEUTERED"/>
        <result property="petIntroduce" column="PET_INTRODUCE"/>
        <association property="refMemCode" column="REF_MEM_CODE"/>
    </resultMap>

    <insert id="insertPet">
        INSERT INTO PET_INFO (PET_NICK,
                              PET_KIND,
                              PET_BIRTH,
                              PET_GENDER,
                              PET_NEUTERED,
                              PET_WEIGHT,
                              REF_MEM_CODE)

        VALUES (
                #{ petNick },
                #{ petKind },
                #{ petBirth },
                #{ petGender },
                #{ petNeutered },
                #{ petWeight },
                (SELECT
                    A.MEM_CODE FROM MEM_INFO A LEFT JOIN PET_INFO B
                ON A.MEM_CODE = B.REF_MEM_CODE
                WHERE B.REF_MEM_CODE IS NULL
                LIMIT 1
                )
                )
    </insert>



    <select id="getPetInfoByMemCode" resultMap="petResultMap">
        SELECT
            PET_CODE
            ,PET_NICK
            ,PET_KIND
            ,PET_BIRTH
            ,PET_GENDER
            ,PET_WEIGHT
            ,PET_NEUTERED
            ,PET_INTRODUCE
        FROM
            PET_INFO
        WHERE REF_MEM_CODE = (
            SELECT MEM_CODE
            FROM MEM_INFO
            WHERE MEM_ID = #{ memId }
            );
    </select>
</mapper>


