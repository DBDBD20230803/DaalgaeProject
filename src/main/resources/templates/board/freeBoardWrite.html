<!DOCTYPE html>
<html lang="ko" dir="ltr" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/boardLayout}">
<head>
    <title>자유게시판 글 작성</title>
</head>

<th:block layout:fragment="content">
    <div class="board-banner">
        <h3>자유게시판</h3>
        <div>
            <img th:src="@{/images/board-banner-image-2.png}" class="board-banner-image-2" alt="play-with-dog-image">
        </div>
    </div>

    <div class="board-container container">
        <form th:action="@{/board/freeBoardWrite}" id="boardWriteForm" method="post" enctype="multipart/form-data">
            <input
                    type="hidden"
                    id="refPostWriter.memCode"
                    name="refPostWriter.memCode"
                    th:value="${ #authentication.getPrincipal().getMemCode() }"
            >
            <input type="hidden" name="postType" th:value="자유">
        <div class="header-board-write-text">
            <h2>글쓰기</h2>
        </div>
        <div class="board-write-header">
            <div class="category">
                <select name="postSort" id="HeadTitle">
                    <option value="자유">자유</option>
                    <option value="용품">용품</option>
                    <option value="먹거리">먹거리</option>
                </select>
            </div>
            <div class="write-title">
                <input type="text" name="postTitle" id="title" placeholder="제목을 입력해주세요.">
            </div>
            <div class="imageUpload">
                <label for="imageUpload" class="label-imageUpload" id="imageUploadButton">
                    <img th:src="@{/images/imageUpload.png}" alt="이미지업로드">
                </label>
                <input type="file" name="imageUpload" id="imageUpload" style="display: none;">
            </div>
        </div>
        <div class="title-img-area" id="titleImgArea">
            <img id="titleImg" style="width: 350px; height: 200px">
        </div>
        <div class="board-write-content">
            <textarea name="postContent" id="content" cols="30" rows="10"></textarea>
        </div>
        <div class="thumbnail-file-area">
            <input type="file" id="thumbnailImg1" name="thumbnailImg1" onchange="loadImg(this,1)">
            <input type="file" id="thumbnailImg2" name="thumbnailImg2" onchange="loadImg(this,2)">
            <input type="file" id="thumbnailImg3" name="thumbnailImg3" onchange="loadImg(this,3)">
            <input type="file" id="thumbnailImg4" name="thumbnailImg4" onchange="loadImg(this,4)">
        </div>
        <div class="board-write-buttons">
            <div class="write-button">
                <button type="submit">작성완료</button>
            </div>
            <div class="write-cancel">
                <a th:href="@{/board/freeBoard}">취소</a>
            </div>
        </div>
        </form>
    </div>

    <script th:inline="javascript">

        /* 이미지 미리보기 관련 스크립트 */
        const $titleImgArea = document.getElementById("titleImgArea");
        const $contentImgArea1 = document.getElementById("contentImgArea1");
        const $contentImgArea2 = document.getElementById("contentImgArea2");
        const $contentImgArea3 = document.getElementById("contentImgArea3");

        $titleImgArea.onclick = function() {
            document.getElementById("thumbnailImg1").click();
        }

        $contentImgArea1.onclick = function() {
            document.getElementById("thumbnailImg2").click();
        }

        $contentImgArea2.onclick = function() {
            document.getElementById("thumbnailImg3").click();
        }

        $contentImgArea3.onclick = function() {
            document.getElementById("thumbnailImg4").click();
        }

        /* 이미지 미리보기 관련 함수(File API 활용하기) */
        function loadImg(value, num) {

            /* https://developer.mozilla.org/ko/docs/Web/API/FileReader 참고 (MDN 사이트 참고)*/
            if (value.files && value.files[0]) {			// value.files[0]는 파일 이름
                const reader = new FileReader();

                /*
                    FileReader 객체는 웹 애플리케이션이 비동기적으로 데이터를 읽기 위하여 읽을 파일을 가리키는 File 혹은 Blob 객체를
                    이용해 파일의 내용을(혹은 raw data버퍼로) 읽고 사용자의 컴퓨터에 저장하는 것을 가능하게 하는 것
                    Blob(Binary large object) : 파일류의 불변하는 미가공 데이터로 텍스트와 이진 데이터의 형태로 읽을 수 있음
                */

                // reader.readAsText(value.files[0]);			// 텍스트 파일을 읽을 때 사용 (이미지 파일을 텍스트로 읽어서 글자가 깨짐)
                // reader.readAsArrayBuffer(value.files[0]);	// 데이터를 일정한 크기로 조금씩(파일을 표현하는 ArrayBuffer) 서버로 보낼 때
                // reader.readAsBinaryString(value.files[0]);	// 이진 데이터를 서버로 보낼 때 사용
                reader.readAsDataURL(value.files[0]);		// Base64방식으로 파일을 FileReader에 전달 (Base64로 인코딩한 것은 브라우저가 원래 데이터로 만들게 됨)

                /* load 이벤트의 핸들러로 읽기 동작이 성공적으로 완료 되었을 때마다 발생한다. */
                reader.onload = function(e) {				// load EventListener에 function 등록 (FileReader에서 전달 받은 파일을 다 읽으면 리스너에 등록한 function이 호출 됨)
                    switch(num){
                        case 1:
                            console.log(e.target.result);		// e.target.result는 인코딩한 결과로 img태그의 src로 사용할 수 있음
                            document.getElementById("titleImg").src = e.target.result;
                            break;
                        case 2:
                            document.getElementById("contentImg1").src = e.target.result;
                            break;
                        case 3:
                            document.getElementById("contentImg2").src = e.target.result;
                            break;
                        case 4:
                            document.getElementById("contentImg3").src = e.target.result;
                            break;
                    }
                }
            }
        }
    </script>

</th:block>
</html>